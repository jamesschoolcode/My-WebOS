<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebOS - MacStyle</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: sans-serif;
      background: url('https://wallpaperaccess.com/full/317501.jpg') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
    }
    #desktop {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    #taskbar {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 60px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .app-icon {
      margin: 0 15px;
      cursor: pointer;
      font-size: 28px;
      user-select: none;
    }
    .window {
      position: absolute;
      width: 600px;
      height: 400px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      overflow: hidden;
      resize: both;
      z-index: 1;
      display: flex;
      flex-direction: column;
    }
    .title-bar {
      background: #333;
      color: white;
      padding: 5px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: move;
      user-select: none;
      flex-shrink: 0;
    }
    .content {
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
      background: #f0f0f0;
    }
    .file-explorer ul { list-style: none; }
    .file-explorer li { margin: 5px 0; }
    .terminal {
      background: #1e1e1e;
      color: #00ff88;
      font-family: monospace;
      font-size: 14px;
      height: 100%;
      overflow-y: auto;
      padding: 10px;
    }
    .input-line input {
      background: transparent;
      border: none;
      color: #00ff88;
      outline: none;
      font-family: monospace;
      width: 100%;
    }
    iframe.browser-frame {
      border: none;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="desktop"></div>
  <div id="taskbar">
    <div class="app-icon" onclick="openTerminal()">üñ•Ô∏è</div>
    <div class="app-icon" onclick="openFileExplorer()">üìÅ</div>
    <div class="app-icon" onclick="openBrowser()">üåê</div>
    <div class="app-icon" onclick="openAppStore()">üõí</div>
  </div>
  <script>
    let zIndex = 10;
    let fs = JSON.parse(localStorage.getItem('filesystem')) || { '/': {} };
    let currentPath = '/';

    // Simple user & game data simulation
    let users = JSON.parse(localStorage.getItem('users')) || { guest: { installedGames: [] } };
    let currentUser = 'guest';

    function saveFS() {
      localStorage.setItem('filesystem', JSON.stringify(fs));
    }
    function saveUsers() {
      localStorage.setItem('users', JSON.stringify(users));
    }
    function getDir(path) {
      const parts = path.split('/').filter(Boolean);
      let dir = fs['/'];
      for (let part of parts) {
        if (!dir[part] || typeof dir[part] !== 'object') return null;
        dir = dir[part];
      }
      return dir;
    }

    function makeWindow(title, contentHTML) {
      const win = document.createElement('div');
      win.className = 'window';
      win.style.top = '100px';
      win.style.left = '100px';
      win.style.zIndex = zIndex++;

      const titleBar = document.createElement('div');
      titleBar.className = 'title-bar';
      titleBar.innerHTML = `<span>${title}</span><span style="cursor:pointer;">‚ùå</span>`;
      titleBar.querySelector('span:last-child').onclick = () => win.remove();

      const content = document.createElement('div');
      content.className = 'content';
      content.innerHTML = contentHTML;

      win.appendChild(titleBar);
      win.appendChild(content);
      document.getElementById('desktop').appendChild(win);
      makeDraggable(win, titleBar);
      return content;
    }

    function makeDraggable(win, bar) {
      let isDown = false, offsetX, offsetY;
      bar.onmousedown = (e) => {
        isDown = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        win.style.zIndex = zIndex++;
      };
      document.onmouseup = () => isDown = false;
      document.onmousemove = (e) => {
        if (isDown) {
          win.style.left = (e.clientX - offsetX) + 'px';
          win.style.top = (e.clientY - offsetY) + 'px';
        }
      };
    }

    // --- Terminal ---
    function openTerminal() {
      const term = makeWindow('Terminal', '<div class="terminal" id="terminal"></div>');
      const termDiv = term.querySelector('#terminal');

      function printPrompt() {
        const line = document.createElement('div');
        line.className = 'input-line';
        line.innerHTML = `user@webos:${currentPath}$ <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">`;
        termDiv.appendChild(line);
        const input = line.querySelector('input');
        input.focus();
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            const output = document.createElement('div');
            const result = runCommand(input.value);
            output.textContent = result;
            termDiv.appendChild(output);
            input.disabled = true;
            printPrompt();
            termDiv.scrollTop = termDiv.scrollHeight;
          }
        });
      }
      function runCommand(cmd) {
        const parts = cmd.trim().split(' ');
        const base = parts[0], args = parts.slice(1);
        const dir = getDir(currentPath);
        if (!dir) return 'Invalid path';

        switch (base) {
          case 'mkdir':
            if (!args[0]) return 'Usage: mkdir [foldername]';
            if (dir[args[0]]) return 'Folder/file exists';
            dir[args[0]] = {};
            saveFS();
            return '';
          case 'touch':
            if (!args[0]) return 'Usage: touch [filename]';
            dir[args[0]] = '';
            saveFS();
            return '';
          case 'echo':
            const i = args.indexOf('>');
            if (i !== -1) {
              const file = args[i + 1];
              if (!file) return 'Usage: echo [text] > [filename]';
              const txt = args.slice(0, i).join(' ');
              dir[file] = txt;
              saveFS();
              return '';
            } else return args.join(' ');
          case 'cat':
            if (!args[0]) return 'Usage: cat [filename]';
            return dir[args[0]] || 'File not found';
          case 'ls':
            return Object.keys(dir).join('  ');
          case 'cd':
            if (!args[0]) return 'Usage: cd [directory]';
            if (args[0] === '..') {
              const parts = currentPath.split('/').filter(Boolean);
              parts.pop();
              currentPath = '/' + parts.join('/') + (parts.length ? '/' : '');
            } else if (dir[args[0]] && typeof dir[args[0]] === 'object') {
              currentPath += args[0] + '/';
            } else return 'No such directory';
            return '';
          case 'clear':
            termDiv.innerHTML = '';
            return '';
          default:
            return 'Command not found';
        }
      }
      printPrompt();
    }

    // --- File Explorer ---
    function openFileExplorer() {
      const content = makeWindow('File Explorer', '<div class="file-explorer" id="explorer"></div>');
      renderExplorer('/');

      function renderExplorer(path) {
        const dir = getDir(path);
        if (!dir) return;
        let html = `<ul>`;
        for (let key in dir) {
          if (typeof dir[key] === 'object') {
            html += `<li><b>[${key}]</b> <button onclick="exploreDir('${path + key}/')">Open</button></li>`;
          } else {
            html += `<li>${key}: ${dir[key]}</li>`;
          }
        }
        html += `</ul>`;
        document.getElementById('explorer').innerHTML = `
          <div><button onclick="exploreDir('${getParentPath(path)}')">‚¨ÜÔ∏è Up</button></div>
          <div><strong>Current Path: ${path}</strong></div>
          ${html}
        `;
      }
      window.exploreDir = renderExplorer;

      function getParentPath(p) {
        const parts = p.split('/').filter(Boolean);
        parts.pop();
        return '/' + parts.join('/') + (parts.length ? '/' : '');
      }
    }

    // --- Browser ---
    function openBrowser() {
      const content = makeWindow('Web Browser', `
        <div style="margin-bottom:8px;">
          <input id="browser-url" type="text" placeholder="https://example.com" style="width: 80%;">
          <button onclick="loadURL()">Go</button>
        </div>
        <iframe class="browser-frame" id="browser-frame" src=""></iframe>
      `);

      window.loadURL = function () {
        const input = content.querySelector('#browser-url');
        let url = input.value.trim();
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          url = 'https://' + url;
        }
        content.querySelector('#browser-frame').src = url;
      };
    }

    // --- App Store (Improved with images) ---
    function openAppStore() {
      const content = makeWindow('App Store', '<div id="appstore-list" style="display: flex; flex-wrap: wrap; gap: 20px; padding: 10px;"></div>');
      const appstoreList = content.querySelector('#appstore-list');
      appstoreList.innerHTML = '';

      // Games with icon URLs (replace icons as you want)
      const storeGames = [
        { name: 'Snake', icon: 'https://img.icons8.com/ios-filled/50/000000/snake.png' },
        { name: 'Pong', icon: 'https://img.icons8.com/ios-filled/50/000000/tennis.png' },
        { name: 'Guess the Number', icon: 'https://img.icons8.com/ios-filled/50/000000/question-mark.png' },
        { name: 'Blank Game', icon: 'https://img.icons8.com/ios-filled/50/000000/game-controller.png' }
      ];

      storeGames.forEach(game => {
        const card = document.createElement('div');
        card.style.width = '120px';
        card.style.border = '1px solid #ccc';
        card.style.borderRadius = '8px';
        card.style.padding = '10px';
        card.style.textAlign = 'center';
        card.style.background = 'rgba(255, 255, 255, 0.9)';
        card.style.cursor = 'pointer';
        card.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
        card.style.transition = 'transform 0.2s ease';
        card.onmouseover = () => card.style.transform = 'scale(1.05)';
        card.onmouseout = () => card.style.transform = 'scale(1)';

        const img = document.createElement('img');
        img.src = game.icon;
        img.alt = game.name;
        img.style.width = '60px';
        img.style.height = '60px';
        img.style.marginBottom = '8px';

        const name = document.createElement('div');
        name.textContent = game.name;
        name.style.fontWeight = '600';
        name.style.marginBottom = '8px';

        const btn = document.createElement('button');
        btn.textContent = 'Install';
        btn.style.padding = '6px 10px';
        btn.style.border = 'none';
        btn.style.borderRadius = '4px';
        btn.style.background = '#0078D7';
        btn.style.color = 'white';
        btn.style.cursor = 'pointer';

        btn.onclick = (e) => {
          e.stopPropagation();
          if (!users[currentUser].installedGames) users[currentUser].installedGames = [];
          if (!users[currentUser].installedGames.includes(game.name)) {
            users[currentUser].installedGames.push(game.name);
            saveUsers();
            alert(`${game.name} installed! Open Games app to play.`);
          } else {
            alert(`${game.name} is already installed.`);
          }
        };

        card.appendChild(img);
        card.appendChild(name);
        card.appendChild(btn);

        appstoreList.appendChild(card);
      });
    }

  </script>
</body>
</html>
